<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Todo</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --primary: #007bff; --bg: #f8f9fa; --text: #212529; }
        
        /* The No-Zoom Fix: Font must be at least 16px */
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            max-width: 500px; 
            margin: 0 auto; 
            padding: 20px; 
            background: var(--bg); 
            color: var(--text); 
            line-height: 1.5;
        }
        
        .input-group { background: white; padding: 16px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 24px; }
        
        /* Ensuring 16px font to prevent browser auto-zoom */
        input[type="text"], input[type="date"], button { 
            font-size: 16px !important; 
        }

        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; outline: none; box-sizing: border-box; }
        .controls { display: flex; gap: 10px; margin-top: 10px; }
        input[type="date"] { flex: 1; border: 1px solid #eee; border-radius: 8px; padding: 8px; }
        button#addBtn { background: var(--primary); color: white; border: none; border-radius: 8px; padding: 0 20px; font-weight: 600; cursor: pointer; }

        h2 { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: #888; margin: 32px 0 12px 4px; }
        ul { list-style: none; padding: 0; margin: 0; }
        li { background: white; margin-bottom: 8px; padding: 14px; border-radius: 12px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
        
        input[type="checkbox"] { width: 22px; height: 22px; margin-right: 14px; cursor: pointer; accent-color: var(--primary); }
        .task-text { flex: 1; }
        li.done { opacity: 0.5; }
        li.done .task-text { text-decoration: line-through; }
        
        .date-tag { font-size: 0.7rem; color: var(--primary); background: #e7f3ff; padding: 2px 8px; border-radius: 4px; font-weight: 600; margin-left: 8px; }
        .del-btn { color: #ffbcbc; border: none; background: none; font-size: 1.4rem; cursor: pointer; padding-left: 10px; }
    </style>
</head>
<body>

    <div class="input-group">
        <input type="text" id="taskInput" placeholder="What's next?" autocomplete="off">
        <div class="controls">
            <input type="date" id="dateInput">
            <button id="addBtn" onclick="addTask()">Add</button>
        </div>
    </div>

    <h2>‚òÄÔ∏è Today</h2>
    <ul id="todayList"></ul>

    <h2>üóìÔ∏è Upcoming</h2>
    <ul id="upcomingList"></ul>

    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').catch(()=>{}); }

        let tasks = JSON.parse(localStorage.getItem('simple_todos')) || [];

        document.getElementById('taskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTask();
        });

        function addTask() {
            const input = document.getElementById('taskInput');
            const dateInput = document.getElementById('dateInput');
            if (!input.value.trim()) return;

            tasks.push({ id: Date.now(), text: input.value.trim(), date: dateInput.value, done: false });
            input.value = ''; dateInput.value = '';
            render();
        }

        function toggle(id) {
            tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
            render();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            render();
        }

        function render() {
            tasks.sort((a, b) => (a.date > b.date) ? 1 : -1);
            localStorage.setItem('simple_todos', JSON.stringify(tasks));
            const todayStr = new Date().toISOString().split('T')[0];
            const tList = document.getElementById('todayList');
            const uList = document.getElementById('upcomingList');
            tList.innerHTML = ''; uList.innerHTML = '';

            tasks.forEach(t => {
                const li = document.createElement('li');
                if (t.done) li.classList.add('done');
                li.innerHTML = `
                    <input type="checkbox" ${t.done ? 'checked' : ''} onclick="toggle(${t.id})">
                    <span class="task-text">${t.text}</span>
                    ${t.date ? `<span class="date-tag">${t.date === todayStr ? 'Today' : t.date}</span>` : ''}
                    <button class="del-btn" onclick="deleteTask(${t.id})">‚úï</button>
                `;
                (t.date === todayStr || !t.date) ? tList.appendChild(li) : uList.appendChild(li);
            });
        }
        render();
    </script>
</body>
</html>
